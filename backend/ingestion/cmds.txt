-- 1. Raw AQI Data
CREATE TABLE IF NOT EXISTS air_quality (
    id SERIAL PRIMARY KEY,
    city VARCHAR(100) NOT NULL,
    station VARCHAR(150),
    pollutant_id VARCHAR(20),
    pollutant_min FLOAT,
    pollutant_max FLOAT,
    pollutant_avg FLOAT,
    last_update TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS google_air_quality (
    latitude NUMERIC(10, 6) NOT NULL,
    longitude NUMERIC(10, 6) NOT NULL,
    data_time TIMESTAMP WITH TIME ZONE NOT NULL,
    aqi INT,
    co NUMERIC(10, 2),
    no2 NUMERIC(10, 2),
    so2 NUMERIC(10, 2),
    pm10 NUMERIC(10, 2),
    pm2_5 NUMERIC(10, 2),
    PRIMARY KEY (latitude, longitude, data_time)
);

-- 2. Raw Weather Data
CREATE TABLE IF NOT EXISTS weather (
    id SERIAL PRIMARY KEY,
    city VARCHAR(100) NOT NULL,
    temperature FLOAT,
    humidity FLOAT,
    pressure FLOAT,
    description VARCHAR(255),
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 3. Cleaned AQI Data (processed from air_quality)
CREATE TABLE IF NOT EXISTS air_quality_cleaned (
    id SERIAL PRIMARY KEY,
    city VARCHAR(100) NOT NULL,
    station VARCHAR(150),
    pollutant_id VARCHAR(20),
    pollutant_avg FLOAT,
    last_update TIMESTAMP,
    processed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 4. Cleaned Weather Data
CREATE TABLE IF NOT EXISTS weather_cleaned (
    id SERIAL PRIMARY KEY,
    city VARCHAR(100) NOT NULL,
    temperature FLOAT,
    humidity FLOAT,
    pressure FLOAT,
    description VARCHAR(255),
    timestamp TIMESTAMP,
    processed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 5. Forecast Table for AQI (ARIMA outputs)
CREATE TABLE IF NOT EXISTS air_quality_forecasts (
    id SERIAL PRIMARY KEY,
    city VARCHAR(100) NOT NULL,
    pollutant_id VARCHAR(20),
    forecast_value FLOAT,
    forecast_timestamp TIMESTAMP,
    model VARCHAR(50) DEFAULT 'ARIMA',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 6. Forecast Table for Weather (ARIMA outputs)
CREATE TABLE IF NOT EXISTS weather_forecasts (
    id SERIAL PRIMARY KEY,
    city VARCHAR(100) NOT NULL,
    parameter VARCHAR(50),  -- e.g., temperature, humidity, pressure
    forecast_value FLOAT,
    forecast_timestamp TIMESTAMP,
    model VARCHAR(50) DEFAULT 'ARIMA',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 7. Model Evaluation Results
CREATE TABLE IF NOT EXISTS model_evaluations (
    id SERIAL PRIMARY KEY,
    model_name VARCHAR(50),
    city VARCHAR(100),
    parameter VARCHAR(50),
    metric VARCHAR(50),    -- e.g., RMSE, MAE, MAPE
    value FLOAT,
    evaluated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Indexes for faster querying
CREATE INDEX IF NOT EXISTS idx_aqi_cleaned_city_time ON air_quality_cleaned(city, last_update);
CREATE INDEX IF NOT EXISTS idx_weather_cleaned_city_time ON weather_cleaned(city, timestamp);
CREATE INDEX IF NOT EXISTS idx_aqi_forecast_city_time ON air_quality_forecasts(city, forecast_timestamp);
CREATE INDEX IF NOT EXISTS idx_weather_forecast_city_time ON weather_forecasts(city, forecast_timestamp);

